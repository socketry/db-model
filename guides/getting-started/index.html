<!DOCTYPE html>
<html>
	<head>
		
			<title>Getting Started</title>
		
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		
		<link rel="icon" type="image/png" href="../../_static/icon.png"/>
		<link rel="stylesheet" href="../../_static/site.css" type="text/css" media="screen"/>
		
		<script src="../../_components/jquery/jquery.min.js"></script>
		<script src="../../_components/jquery-syntax/jquery.syntax.min.js"></script>
		
		<script src="../../_static/links.js"></script>
		
		<script type="text/javascript">
		//<![CDATA[
			jQuery(function($) {
				$.syntax();
			});
		//]]>
		</script>
	</head>

	<body>
		<header> › <a class="link" href="../../index.html">Project</a> › <a class="link" href="../index.html">Guides</a></header>
		
		<main>
			
	<h1>Getting Started</h1>
	
	<p>This guide explains how to use <code>db-model</code> for database schemas.</p>
<section id="installation"><h2>Installation</h2>
<p>Add the gem to your project:</p>
<pre><code class="language-bash">$ bundle add db-model
</code></pre>
</section><section id="core-concepts"><h2>Core Concepts</h2>
<p><code>db-model</code> has several core concepts:</p>
<ul>
<li><a href="http://localhost:33345/source/DB/Model/Schema/index" title="DB::Model::Schema"><code class="language-ruby">module DB::Model::Schema</code></a> defines the schema of your database and must be attached to a <code class="language-ruby">DB::Session</code> in order to interact with a real database. There is no hidden per-thread state.</li>
<li><a href="http://localhost:33345/source/DB/Model/Record/index" title="DB::Model::Record"><code class="language-ruby">module DB::Model::Record</code></a> defines how to interact with rows of data from a table or scope.</li>
<li><a href="http://localhost:33345/source/DB/Model/Relation/index" title="DB::Model::Relation"><code class="language-ruby">class DB::Model::Relation</code></a> defines a way of reading records and there are specific sub-classes:
<ul>
<li><a href="http://localhost:33345/source/DB/Model/Table/index" title="DB::Model::Table"><code class="language-ruby">class DB::Model::Table</code></a> defines a relation which includes all the rows in a table.</li>
<li><a href="http://localhost:33345/source/DB/Model/Scope/index" title="DB::Model::Scope"><code class="language-ruby">class DB::Model::Scope</code></a> defines a relationship with a specific record (i.e. has one, has many, etc).</li>
</ul>
</li>
<li><a href="http://localhost:33345/source/DB/Model/Where/index" title="DB::Model::Where"><code class="language-ruby">class DB::Model::Where</code></a> is used for executing select statements on a database and reading results.</li>
</ul>
</section><section id="connecting-to-postgres"><h2>Connecting to Postgres</h2>
<p>Add the Postgres adaptor to your project:</p>
<pre><code class="language-bash">$ bundle add db-postgres
</code></pre>
<p>Set up the client with the appropriate credentials:</p>
<pre><code class="language-ruby">require 'async'
require 'db/client'
require 'db/postgres'

# Create the client and connection pool:
client = DB::Client.new(DB::Postgres::Adapter.new(database: 'test'))

# This is our database schema:
class TestSchema
	include DB::Model::Schema
	
	class User
		include DB::Model::Record
		
		property :id
		property :name
		
		def posts
			scope(Post, user_id: self.id)
		end
	end
	
	class Post
		include DB::Model::Record
		
		property :id
		property :user_id
		
		def user
			scope(User, id: self.user_id)
		end
	end
	
	def users
		table(User)
	end
	
	def posts
		table(Post)
	end
end

# Create an event loop:
Sync do
	# Connect to the database:
	client.transaction do |context|
		schema = TestSchema.new(context)
		
		# Create a user:
		user = schema.users.create(name: &quot;Posty McPostface&quot;)
		
		# Insert several posts:
		user.posts.insert([:body], [
			[&quot;Hello World&quot;],
			[&quot;Goodbye World&quot;]
		])
	end
end
</code></pre>
</section>
				
			<footer>Documentation generated by <a href="https://github.com/socketry/utopia-project">Utopia::Project</a>.</footer>
		</main>
	</body>
</html>